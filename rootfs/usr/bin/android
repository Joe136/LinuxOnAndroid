#!/bin/bash
# See the file "license.terms" for information on usage and redistribution of
# this file, and for a DISCLAIMER OF ALL WARRANTIES.


function cpu_stats () {
  echo -n "Current Governor: "
  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
  echo -n "Current I/O Scheduler: "
  cat /sys/block/mmcblk0/queue/scheduler | grep -Eoe "\[[a-zA-Z0-9]*\]" | grep -Eoe "[a-zA-Z0-9]*"
  echo -n "Current CPU Frequency: "
  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
  echo -n "Minimum CPU Frequency: "
  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
  echo -n "Maximum CPU Frequency: "
  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
}



##---------------------------Main Loop-----------------------------------##
case "$1" in
start)
  echo "start" | nc localhost 4242

;;
stop)
  echo "stop" | nc localhost 4242

;;
restart)
  echo "restart" | nc localhost 4242

;;
dumpsys)
  echo "dumpsys" | nc localhost 4242
  sleep 2
  #nc -l -p 4243 &
  echo "$2" | nc localhost 4242 && nc -l -p 4243

;;
boost)
  echo "boost" | nc localhost 4242

;;
wlan)
  if [ "$2" == "power" ]; then
    [[ "$3" == "off" ]] && iwconfig wlan0 power off
    [[ "$3" == "on" ]]  && iwconfig wlan0 power on
  elif [ "$2" == "ping" ]; then
    [[ "$3" == "off" ]] && echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all
    [[ "$3" == "on" ]]  && echo 0 > /proc/sys/net/ipv4/icmp_echo_ignore_all
  fi

;;
shell)
  echo "shell" | nc localhost 4242
  read pass
  accept=$(echo "$pass" | nc localhost 4242)
  echo "$accept"
  if [ "$accept" == "true" ]; then
    nc localhost 4242
  fi

;;
stats|info)
  ifconfig wlan0 | head -n 3 && ifconfig wlan0 | tail -n 2 | head -n 1
  echo ""
  iwconfig wlan0 | head -n 3 && iwconfig wlan0 | tail -n 5 | head -n 2
  echo ""
  ifconfig rmnet0 | head -n 3 && ifconfig rmnet0 | tail -n 2 | head -n 1
  echo ""
  echo -n "Response to Ping: "
  if [ "$(cat /proc/sys/net/ipv4/icmp_echo_ignore_all)" == "1" ]; then echo "off"; else echo "on"; fi
  cpu_stats

;;
cpu)
  cpu_stats

;;
*)
  echo "`basename $0` start|stop|restart|dumpsys|boost|wlan|shell|status|info|cpu" 2> /dev/null

;;
esac
